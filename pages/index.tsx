import Head from 'next/head'
import Image from 'next/image'
import Popular from './r/popular'
import { prisma } from '../server/db/client'
import { PostsListProps } from '../types/types'
import Header from '../components/header'

export async function getServerSideProps() {
  const posts = await prisma.post.findMany({
    include: {
      author: true,
      subreddit: true,
      likedBy: {
        select: {
          email: true,
        }
      },
      dislikedBy: {
        select: {
          email: true,
        }
      },
    },
    orderBy: [
      {
        id: 'desc',
      }
    ]
  })
  return {
    props: {
      posts: JSON.parse(JSON.stringify(posts))
    }
  }
}

export default function Home({posts}: PostsListProps) {
  return (
    <div>
      <Head>
        <title>Reddit - Dive into anything</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Popular posts={posts} />
    </div>
  )
}